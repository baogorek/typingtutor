<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Sample FirebaseUI App</title>
    <style>
    body {
      background-image: url('http://blog.hostbaby.com/wp-content/uploads/2013/07/antiquepaper_1920x1234.jpg')
    }
    </style>
    <script src="https://www.gstatic.com/firebasejs/3.9.0/firebase.js"></script>
    <script type="text/javascript">
      var config = {
        apiKey: "AIzaSyDFLZi6KGXURw8nibcJhGhN23-4vbMNV24",
        authDomain: "typingtutor-9f7e9.firebaseapp.com",
        databaseURL: "https://typingtutor-9f7e9.firebaseio.com",
        projectId: "typingtutor-9f7e9",
        storageBucket: "typingtutor-9f7e9.appspot.com",
        messagingSenderId: "736144011972"
      };
      firebase.initializeApp(config);

      initApp = function() {
        let url_params = new URL(window.location.href).searchParams;
        var firebase_token = url_params.get('token');
        firebase.auth().onAuthStateChanged(function(user) {
          if (user) {


            if (!firebase_token) {
              user.getToken().then(function(accessToken) {
                window.location = "?token=" + accessToken;
              });
            }

            document.getElementById('sign-in-status').textContent = 'Signed in';
            document.getElementById('firebase-token').textContent = firebase_token;
            document.getElementById('sign-in-status').textContent =
              'Welcome to typingtutor, ' + user.displayName + '!';

            var dbRefObject = firebase.database().ref().child('test_obj');
            dbRefObject.on('value',
              function(snapshot) {
                document.getElementById('typing-data').textContent = JSON.stringify(snapshot.val());
                console.log(snapshot.val());
              });
          } else { // user needs to sign in
            window.location = "https://baogorek.github.io/typingtutor/"
          }
        });
      };

      function copyToClipboard(text) {
          window.prompt("Copy to clipboard: Ctrl+C, Enter", text);
      }

    </script>
  </head>
  <body onload="initApp();">
    <h1 id = "welcome"></h1>
    <div id="sign-in-status"></div>

    <div id="firebase-token"></div>

    <button id="copy-token"
      onclick="copyToClipboard(document.getElementById('firebase-token').textContent)">
      Click here to copy token to clipboard
    </button>

    <div id="typing-data"></div>
  </body>
</html>
