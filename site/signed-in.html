<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Sample FirebaseUI App</title>
    <style>
      body {
        background-image: url('http://blog.hostbaby.com/wp-content/uploads/2013/07/antiquepaper_1920x1234.jpg')
      }
    .button {
      display: inline-block;
      padding: 15px 25px;
      font-size: 24px;
      cursor: pointer;
      text-align: center;
      text-decoration: none;
      outline: none;
      color: #fff;
      background-color: #4CAF50;
      border: none;
      border-radius: 15px;
      box-shadow: 0 9px #999;
    }
    
    .button:hover {background-color: #3e8e41}
    
    .button:active {
      background-color: #3e8e41;
      box-shadow: 0 5px #666;
      transform: translateY(4px);
    }
    </style>
    <script src="https://www.gstatic.com/firebasejs/3.9.0/firebase.js"></script>
    <script type="text/javascript">
      var config = {
        apiKey: "AIzaSyDFLZi6KGXURw8nibcJhGhN23-4vbMNV24",
        authDomain: "typingtutor-9f7e9.firebaseapp.com",
        databaseURL: "https://typingtutor-9f7e9.firebaseio.com",
        projectId: "typingtutor-9f7e9",
        storageBucket: "typingtutor-9f7e9.appspot.com",
        messagingSenderId: "736144011972"
      };
      firebase.initializeApp(config);

      initApp = function() {

        document.getElementById('firebase-token').style.display = 'none';
        firebase.auth().onAuthStateChanged(function(user) {
          if (user) {
            
            //user.getToken().then(function(accessToken) {
            //  document.getElementById('firebase-token').textContent = accessToken;
            //});
            document.getElementById('welcome').textContent =
              'Welcome to typingtutor, ' + user.displayName + '!';

            var dbRefObject = firebase.database().ref().child('test_obj');
            dbRefObject.on('value',
              function(snapshot) {
                document.getElementById('typing-data').textContent =
                  JSON.stringify(snapshot.val());
                console.log(snapshot.val());
              });
          } else { // user needs to sign in
            window.location = "https://baogorek.github.io/typingtutor/"
          }
        });
      };

      function copyToClipboard(text) {
          window.prompt("Copy to clipboard: Ctrl+C, Enter", text);
      };

      function refreshToken() {
       firebase.auth().onAuthStateChanged(function(user) {
          if (user) {
            user.getToken().then(function(accessToken) {
              //document.getElementById('firebase-token').textContent = accessToken;
              copyToClipboard("{\"token\":\"" + accessToken +
              "\", \"userid\":\"" + firebase.auth().currentUser.uid + "\"}")
            });
          };
        });
      };
    </script>
  </head>
  <body onload="initApp();">
    <h1><div id = "welcome"></div></h1>

    <div id="firebase-token"></div>

    <button class="button" id="copy-token"
      onclick='refreshToken();'>
      Click to copy authentication metadata
    </button>

    <div id="typing-data"></div>
  </body>
</html>
