<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Sample FirebaseUI App</title>
    <script src="https://www.gstatic.com/firebasejs/3.9.0/firebase.js"></script>
    <script>
      // Initialize Firebase
      var config = {
        apiKey: "AIzaSyDFLZi6KGXURw8nibcJhGhN23-4vbMNV24",
        authDomain: "typingtutor-9f7e9.firebaseapp.com",
        databaseURL: "https://typingtutor-9f7e9.firebaseio.com",
        projectId: "typingtutor-9f7e9",
        storageBucket: "typingtutor-9f7e9.appspot.com",
        messagingSenderId: "736144011972"
      };

      firebase.initializeApp(config);

      function getParameterByName(name, url) {
          if (!url) url = window.location.href;
          name = name.replace(/[\[\]]/g, "\\$&");
          var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
              results = regex.exec(url);
          if (!results) return null;
          if (!results[2]) return '';
          return decodeURIComponent(results[2].replace(/\+/g, " "));
      }

    initApp = function() {

      var my_auth = firebase.auth();
      var my_user = my_auth.currentUser;
      var provider = new firebase.auth.GithubAuthProvider();

      if (!my_user) {  // Not recommended - https://firebase.google.com/docs/auth/web/manage-users
        my_auth.signInWithPopup(provider);
        var my_user = my_auth.currentUser;
      }
 
      var fb_token = null;
      my_user.getToken().then( // getToken returns a "promise"
        function(accessToken) {
           fb_token = accessToken;
        });

      document.getElementById("firebase-token").textContent = fb_token;

      var xmlHttp = new XMLHttpRequest();
      var the_url = "https://typingtutor-9f7e9.firebaseio.com/with_chris.json?auth=" + 
                 fb_token;
      xmlHttp.open("GET", the_url, true); // false for synchronous request
      xmlHttp.send(null);
      document.getElementById("data-sample").textContent = 
        JSON.stringify(xmlHttp.responseText);
    }

    window.addEventListener('load', function() {
      initApp()
    });

    </script>
  </head>
  <body>
    <h1>The tokens will appear below</h1>
    <div id="firebase-token"></div>
    <div id="data-sample"></div>
  </body>
</html>
